/*
 *	Deal with systemfiles :)
 *	Copyright
 *		(C) 2021 Parsa Mahmoudy sahebi
 *
 *	This file is part of Lv
 */

#include "types.h"

/*
 *	load file of given path and write it into buffer
 */
int laod_file_into_buffer(buffer *buf,char *filepath)
{
	FILE *fp = fopen(filepath, "r");
	/* if file not found , return NOT FOUND */
	if (!fp) 
		return FNOTF;	
	buf = buf != NULL ? buf : curbp;
	int lines = 0;
	char *line = NULL;
	size_t linecap = 0;
	ssize_t linelen;
	while ((linelen = getline(&line, &linecap, fp)) != -1 && lines < term.t_mrow - 1) {
		while (linelen > 0 && (line[linelen - 1] == '\n' ||	line[linelen - 1] == '\r'))
			linelen--;

		if (buf->lline == NULL)
			buf->lline = line_alloc(line,linelen);
		else {
			slnext(buf->lline,line_alloc(line,linelen));
			buf->lline = lnext(buf->lline);
		}
		buf->lcount++;
	}
	free(line);
	fclose(fp);
}
